<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.caffeesys.cafesystem.claim.service.ClaimMapper">
	<!-- ClaimVo resultmap -->
	<resultMap type="com.caffeesys.cafesystem.claim.service.ClaimVO" id="resultClaim">
		<result property="customerClaimCode" column="customer_claim_code" /> <!-- 클레임 관리코드(PK) -->
		<result property="claimCategoryCode" column="claim_category_code" /> <!-- 카테고리(FK) -->
		<result property="employeeCode" column="employee_code" /> <!-- 직원코드(FK) -->
		<result property="customerClaimTitle" column="customer_claim_title" /> <!-- 제목 -->
		<result property="customerClaimContents" column="customer_claim_contents" /> <!-- 내용 -->
		<result property="customerClaimDate" column="customer_claim_date" /> <!-- 작성일 -->
		<result property="customerClaimFile" column="customer_claim_file" /> <!-- 첨부파일 -->
		<result property="claimCategoryName" column="category_small" />
	</resultMap>

	<!-- CategoryVo resultMap -->
	<resultMap type="com.caffeesys.cafesystem.Category" id="resultCategory">
		<result property="categoryCode" column="category_code" /> <!-- 코드(PK) -->
		<result property="categoryLarge" column="category_large" /> <!-- 대분류 -->
		<result property="categoryMiddle" column="category_middle" /> <!-- 중분류 -->
		<result property="categorySmall" column="category_small" /> <!-- 소분류 -->
	</resultMap>

	<!-- 클레임 게시글 총 숫자 불러오기 -->
	<select id="getClaimCount" resultType="Integer">
		SELECT COUNT(*) FROM customer_claim
	</select>
	
	<!-- 클레임 카테고리 불러오기 -->
	<select id="selectCategoryForClaim" resultMap="resultCategory">
		SELECT
			category_code
			, category_large
			, category_middle
			, category_small
		FROM category 
		WHERE category_middle = 'Claim'
	</select>

	<!-- 클레임 게시글 삭제 -->
	<delete id="deleteClaim" parameterType="Integer">
		DELETE
		FROM customer_claim
		WHERE customer_claim_code = #{customerClaimCode}
	</delete>

	<!-- 클레임 게시글 업데이트(수정) -->
	<update id="updateClaim" parameterType="com.caffeesys.cafesystem.claim.service.ClaimVO">
		UPDATE customer_claim
		SET claim_category_code = #{claimCategoryCode}
			, customer_claim_title = #{customerClaimTitle}
			, customer_claim_contents = #{customerClaimContents}
			, customer_claim_file = #{customerClaimFile}
		WHERE customer_claim_code = #{customerClaimCode}
	</update>

	<!-- 클레임 상세보기 페이지 셀렉트 -->
	<select id="selectOneForDetail" parameterType="Integer" resultMap="resultClaim">
		SELECT 
			customer_claim_code
			, claim_category_code
			, employee_code
			, customer_claim_title
			, customer_claim_contents
			, customer_claim_date
			, customer_claim_file
			, category.category_small
		FROM customer_claim
			INNER JOIN category
			ON customer_claim.claim_category_code = category.category_code
		WHERE customer_claim_code = #{customerClaimCode}
	</select>

	<!-- 클레임 리스트 셀렉트 -->
	<select id="getClaimList" parameterType="java.util.Map" resultMap="resultClaim">
		SELECT
			customer_claim_code
			, claim_category_code
			, employee_code
			, customer_claim_title
			, customer_claim_contents
			, customer_claim_date
			, customer_claim_file
			, category.category_small
		FROM customer_claim
			INNER JOIN category
			ON customer_claim.claim_category_code = category.category_code
		ORDER BY customer_claim_code DESC
		LIMIT #{beginRow}, #{pagePerRow}
	</select>

	<!-- 클레임 게시글 입력처리 -->
	<insert id="insertClaim" parameterType="com.caffeesys.cafesystem.claim.service.ClaimVO">
		INSERT INTO customer_claim (
			customer_claim_code
			, claim_category_code
			, employee_code
			, customer_claim_title
			, customer_claim_contents
			, customer_claim_date
			, customer_claim_file
		) VALUES (
			#{customerClaimCode}
			, #{claimCategoryCode}
			, #{employeeCode}
			, #{customerClaimTitle}
			, #{customerClaimContents}
			, now()
			, #{customerClaimFile}
		)
	</insert>
</mapper>